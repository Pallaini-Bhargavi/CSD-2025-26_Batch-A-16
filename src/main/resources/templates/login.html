<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Login</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .required::after {
            content: " *";
            color: red;
        }
    </style>
</head>
<body>

<button class="back-btn" onclick="location.href='/'">‚Üê Back</button>

<div class="page-header">
    <div class="project-title">üîê Secure Data Hiding using Calendar Heatmap steganography</div>
    <div class="page-subtitle">Login</div>
</div>

<div class="container">
    <div class="card">

        <!--  FORM SUBMITS TO BACKEND -->
        <form action="/login" method="post" onsubmit="return validateLogin()">

            <label class="required">Email</label>
            <input type="email" name="email" id="email" placeholder="Enter Email">

            <label class="required">Password</label>
            <input type="password" name="password" id="password" placeholder="Enter Password">

            <button id="loginBtn" type="submit" class="btn">Login</button>

            <div style="margin-top:14px; text-align:center;">
                <a href="/forgot-password"
                   style="color:#38bdf8; text-decoration:none; font-size:17px;">
                    Forgot / Reset Password?
                </a>
            </div>
        </form>

    </div>
</div>

<!-- ================= ERROR POPUP ================= -->
<div id="errorPopup" style="display:none; position:fixed; inset:0;
background:rgba(0,0,0,0.7); z-index:999; align-items:center; justify-content:center;">
    <div style="background:#fff; color:#dc2626; padding:22px; border-radius:16px;
                width:360px; text-align:center; font-weight:600; position:relative;">
        <span onclick="closeError()" style="position:absolute; top:10px; right:14px;
              cursor:pointer; font-size:18px; color: black;">‚úñ</span>
        <div id="errorMsg"></div>
    </div>
</div>

<div id="logoutPopup"
     th:if="${param.logout}">
    <div style="
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.6);
        z-index:999;
        display:flex;
        align-items:center;
        justify-content:center;">
        <div style="
            background:#fff;
            color:#16a34a;
            padding:22px;
            border-radius:16px;
            width:360px;
            text-align:center;
            font-weight:600;">
            Logged out successfully
        </div>
    </div>
</div>

<script th:if="${param.logout}">
    setTimeout(() => {
        document.getElementById("logoutPopup")?.remove();
    }, 1200);
</script>

<script>
function validateLogin() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const btn = document.getElementById("loginBtn");

    if (!email && !password) {
        showError("Please fill the form.");
        return false;
    }

    if (!email) {
        showError("Email is required.");
        return false;
    }

    if (!password) {
        showError("Password is required.");
        return false;
    }

    btn.disabled = true;
    return true; 
}

function showError(msg) {
    document.getElementById("errorMsg").innerText = msg;
    document.getElementById("errorPopup").style.display = "flex";

    const btn = document.getElementById("loginBtn");
    if (btn) btn.disabled = false;
}
function closeError() {
    document.getElementById("errorPopup").style.display = "none";

    const btn = document.getElementById("loginBtn");
    if (btn) btn.disabled = false;
}
</script>

<script th:if="${loginError}">
    window.onload = () => {
        showError("[[${loginError}]]");
    };
</script>

</body>
</html>
